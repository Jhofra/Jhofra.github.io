<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Biblioteca Online - Versión Mejorada</title>
  <style>
    /* RESET Y ESTILOS BÁSICOS */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: Arial, sans-serif;
      background-color: #f9f9f9;
      color: #333;
      margin: 0;
    }
    /* ENCABEZADO */
    header {
      display: flex;
      align-items: center;
      background-color: #4285F4;
      color: #fff;
      padding: 10px;
      position: relative;
      justify-content: center;
    }
    /* BARRA DE BÚSQUEDA */
    .search-container {
      position: absolute;
      left: 20px;
      bottom: -20px;
      background-color: #fff;
      border-radius: 4px;
      padding: 5px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    .search-container input[type="text"] {
      border: none;
      outline: none;
      padding: 5px;
    }
    /* MENÚ LATERAL (NAV) */
    nav {
      width: 200px;
      background-color: #fff;
      box-shadow: 2px 0 5px rgba(0,0,0,0.1);
      padding: 20px;
    }
    nav ul {
      list-style: none;
      margin-top: 60px;
    }
    nav ul li {
      margin-bottom: 10px;
    }
    nav ul li a {
      text-decoration: none;
      color: #4285F4;
      font-weight: bold;
    }
    /* CONTENIDO PRINCIPAL */
    main {
      flex: 1;
      padding: 20px;
      margin-top: 40px;
    }
    section {
      background-color: #fff;
      margin-bottom: 30px;
      padding: 15px;
      border-radius: 5px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    section h2 {
      border-bottom: 2px solid #4285F4;
      padding-bottom: 5px;
      margin-bottom: 10px;
    }
    .book {
      border-bottom: 1px solid #ddd;
      padding: 10px 0;
    }
    .book:last-child {
      border-bottom: none;
    }
    /* RESULTADOS DE BÚSQUEDA */
    #searchResults {
      display: none;
    }
    .search-result {
      border-bottom: 1px solid #ddd;
      padding: 10px 0;
    }
    .search-result:last-child {
      border-bottom: none;
    }
    /* CONTENEDOR PRINCIPAL (NAV + MAIN) */
    .container {
      display: flex;
    }
    /* PIE DE PÁGINA */
    footer {
      background-color: #eee;
      text-align: center;
      padding: 10px;
      margin-top: 20px;
    }
    /* PANEL DE ADMINISTRADOR */
    #adminPanel {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      z-index: 1000;
      display: none;
      justify-content: center;
      align-items: center;
    }
    #adminPanel .admin-content {
      background: #fff;
      padding: 20px;
      width: 80%;
      max-height: 90%;
      overflow-y: auto;
      border-radius: 5px;
      position: relative;
    }
    #adminPanel button#closeAdminBtn {
      position: absolute;
      top: 10px;
      right: 10px;
      background: #4285F4;
      color: #fff;
      border: none;
      padding: 5px 10px;
      cursor: pointer;
      border-radius: 4px;
    }
    .admin-section {
      margin-bottom: 20px;
    }
    .admin-section input,
    .admin-section textarea {
      width: 100%;
      margin-top: 5px;
      padding: 5px;
    }
  </style>
</head>
<body>

  <!-- ENCABEZADO -->
  <header>
    <div class="search-container">
      <input type="text" id="searchInput" placeholder="Buscar libros o autores...">
    </div>
  </header>

  <!-- CONTENIDO PRINCIPAL: NAV + MAIN -->
  <div class="container">
    <!-- MENÚ LATERAL -->
    <nav>
      <ul id="navList">
        <li><a href="#obras-literarias">Obras Literarias</a></li>
        <li><a href="#mangas">Mangas</a></li>
        <li><a href="#novelas-ligeras">Novelas Ligeras</a></li>
        <li><a href="#universidad">Libros para la Universidad</a></li>
        <li><a href="#revistas">Libros para Revistas</a></li>
        <li><a href="#medicos">Libros Médicos</a></li>
        <li><a href="#ensayos">Ensayos</a></li>
        <li><a href="#autores">Autores</a></li>
      </ul>
    </nav>

    <!-- MAIN -->
    <main id="mainContent">
      <!-- Sección de Resultados de Búsqueda -->
      <section id="searchResults">
        <h2>Resultados de Búsqueda</h2>
        <div id="resultsContainer"></div>
      </section>

      <!-- Secciones por categoría -->
      <section id="obras-literarias">
        <h2>Obras Literarias</h2>
        <div id="books-obras-literarias"></div>
      </section>

      <section id="mangas">
        <h2>Mangas</h2>
        <div id="books-mangas"></div>
      </section>

      <section id="novelas-ligeras">
        <h2>Novelas Ligeras</h2>
        <div id="books-novelas-ligeras"></div>
      </section>

      <section id="universidad">
        <h2>Libros para la Universidad</h2>
        <div id="books-universidad"></div>
      </section>

      <section id="revistas">
        <h2>Libros para Revistas</h2>
        <div id="books-revistas"></div>
      </section>

      <section id="medicos">
        <h2>Libros Médicos</h2>
        <div id="books-medicos"></div>
      </section>

      <section id="ensayos">
        <h2>Ensayos</h2>
        <div id="books-ensayos"></div>
      </section>

      <section id="autores">
        <h2>Autores</h2>
        <div id="books-autores"></div>
      </section>
    </main>
  </div>

  <!-- PIE DE PÁGINA -->
  <footer>
    <p>&copy; 2025 Biblioteca Online</p>
  </footer>

  <!-- LIBRERÍAS -->
  <script src="https://cdn.jsdelivr.net/npm/fuse.js/dist/fuse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/epubjs/dist/epub.min.js"></script>

  <!-- SCRIPT PRINCIPAL -->
  <script>
    const books = [
      { title: "Cien Años de Soledad", author: "Gabriel García Márquez", category: "Obras Literarias", description: "Una obra maestra de la literatura latinoamericana." },
      { title: "La Casa de los Espíritus", author: "Isabel Allende", category: "Obras Literarias", description: "Una saga familiar llena de realismo mágico." },
      { title: "Naruto", author: "Masashi Kishimoto", category: "Mangas", description: "Historia de ninjas y aventuras." },
      { title: "One Piece", author: "Eiichiro Oda", category: "Mangas", description: "Aventuras en el mundo de los piratas." },
      { title: "Sword Art Online", author: "Reki Kawahara", category: "Novelas Ligeras", description: "Una novela ligera de realidad virtual y aventuras." },
      { title: "No Game No Life", author: "Yuu Kamiya", category: "Novelas Ligeras", description: "Hermanos en un mundo donde los juegos deciden el destino." },
      { title: "Introducción a la Física", author: "Juan Pérez", category: "Libros para la Universidad", description: "Conceptos fundamentales de la física." },
      { title: "Cálculo Infinitesimal", author: "María López", category: "Libros para la Universidad", description: "Una guía completa para el estudio del cálculo." },
      { title: "Revista de Literatura", author: "Ana Gómez", category: "Libros para Revistas", description: "Publicaciones y reseñas de obras literarias." },
      { title: "Moda y Diseño", author: "Carlos Ruiz", category: "Libros para Revistas", description: "Tendencias y análisis en el mundo del diseño." },
      { title: "Manual de Medicina", author: "Dr. Martínez", category: "Libros Médicos", description: "Referencia para estudiantes y profesionales de la medicina." },
      { title: "Avances en Cirugía", author: "Dr. González", category: "Libros Médicos", description: "Innovaciones y técnicas en el campo de la cirugía." },
      { title: "El Ensayo de la Vida", author: "Laura Jiménez", category: "Ensayos", description: "Reflexiones sobre la existencia y la sociedad." },
      { title: "Pensamientos y Reflexiones", author: "Pedro Sánchez", category: "Ensayos", description: "Ensayos que invitan a la reflexión." }
    ];

    const fuseOptions = {
      keys: ['title', 'author', 'description'],
      threshold: 0.4
    };
    const fuse = new Fuse(books, fuseOptions);

    function renderBooks() {
      const categoriesMap = {
        "Obras Literarias": "books-obras-literarias",
        "Mangas": "books-mangas",
        "Novelas Ligeras": "books-novelas-ligeras",
        "Libros para la Universidad": "books-universidad",
        "Libros para Revistas": "books-revistas",
        "Libros Médicos": "books-medicos",
        "Ensayos": "books-ensayos"
      };

      Object.values(categoriesMap).forEach(id => {
        document.getElementById(id).innerHTML = "";
      });

      books.forEach(book => {
        const containerId = categoriesMap[book.category];
        if (containerId) {
          const container = document.getElementById(containerId);
          const div = document.createElement("div");
          div.className = "book";
          div.innerHTML = `
            <h3>${book.title}</h3>
            <p><strong>Autor:</strong> ${book.author}</p>
            <p>${book.description}</p>
          `;
          container.appendChild(div);
        }
      });

      const authorsContainer = document.getElementById("books-autores");
      authorsContainer.innerHTML = "";
      const uniqueAuthors = {};

      books.forEach(book => {
        if (!uniqueAuthors[book.author]) {
          uniqueAuthors[book.author] = [];
        }
        uniqueAuthors[book.author].push(book.title);
      });

      for (const author in uniqueAuthors) {
        const div = document.createElement("div");
        div.className = "book";
        div.innerHTML = `
          <h3>${author}</h3>
          <p><strong>Obras:</strong> ${uniqueAuthors[author].join(", ")}</p>
        `;
        authorsContainer.appendChild(div);
      }
    }

    renderBooks();

    const searchInput = document.getElementById("searchInput");
    const searchResultsSection = document.getElementById("searchResults");
    const resultsContainer = document.getElementById("resultsContainer");

    searchInput.addEventListener("input", function(e) {
      const query = e.target.value.trim();
      resultsContainer.innerHTML = "";

      if (query === "") {
        searchResultsSection.style.display = "none";
      } else {
        searchResultsSection.style.display = "block";
        const results = fuse.search(query);

        if (results.length > 0) {
          results.forEach(result => {
            const book = result.item;
            const div = document.createElement("div");
            div.className = "search-result";
            div.innerHTML = `
              <h3>${book.title}</h3>
              <p><strong>Autor:</strong> ${book.author}</p>
              <p><em>${book.category}</em></p>
              <p>${book.description}</p>
            `;
            resultsContainer.appendChild(div);
          });
        } else {
          resultsContainer.innerHTML = "<p>No se encontraron resultados.</p>";
        }
      }
    });

    /* ACTIVAR PANEL DE ADMINISTRADOR CON CTRL + BLOQ MAYÚS + 1 */
    document.addEventListener("keydown", function(event) {
      if (event.ctrlKey && event.getModifierState("CapsLock") && event.key === "1") {
        const pass = prompt("Ingrese la contraseña para acceder al Modo Creador:");
        if (pass === "admin123") {
          document.getElementById("adminPanel").style.display = "flex";
        } else {
          alert("Contraseña incorrecta.");
        }
      }
    });

    /* EVENTOS PARA SUBIDA Y VISUALIZACIÓN DE ARCHIVOS */
    document.getElementById("imageUpload").addEventListener("change", function(event) {
      const file = event.target.files[0];
      if(file) {
        const imagePreview = document.getElementById("imagePreview");
        imagePreview.src = URL.createObjectURL(file);
        imagePreview.onload = function() {
          URL.revokeObjectURL(imagePreview.src);
        }
      }
    });

    document.getElementById("pdfUpload").addEventListener("change", function(event) {
      const file = event.target.files[0];
      if(file && file.type === "application/pdf") {
        const pdfContainer = document.getElementById("pdfContainer");
        pdfContainer.innerHTML = `<embed src="${URL.createObjectURL(file)}" type="application/pdf" width="100%" height="500px" />`;
      }
    });

    document.getElementById("epubUpload").addEventListener("change", function(event) {
      const file = event.target.files[0];
      if(file && file.name.endsWith(".epub")) {
        const epubContainer = document.getElementById("epubContainer");
        const url = URL.createObjectURL(file);
        epubContainer.innerHTML = "";
        var book = ePub(url);
        var rendition = book.renderTo("epubContainer", {width: "100%", height: 500});
        rendition.display();
      }
    });

    document.getElementById("createTabBtn").addEventListener("click", function() {
      const title = document.getElementById("newTabTitle").value.trim();
      const content = document.getElementById("newTabContent").value.trim();
      if(title === "" || content === ""){
        alert("Por favor, ingrese título y contenido.");
        return;
      }
      const newId = "custom-tab-" + Date.now();

      const navList = document.getElementById("navList");
      const li = document.createElement("li");
      li.innerHTML = `<a href="#${newId}">${title}</a>`;
      navList.appendChild(li);

      const mainContent = document.getElementById("mainContent");
      const section = document.createElement("section");
      section.id = newId;
      section.innerHTML = `<h2>${title}</h2><p>${content}</p>`;
      mainContent.appendChild(section);

      document.getElementById("newTabTitle").value = "";
      document.getElementById("newTabContent").value = "";
      alert("Nueva pestaña creada exitosamente.");
    });
  </script>

  <!-- PANEL DE ADMINISTRADOR -->
  <div id="adminPanel">
    <div class="admin-content">
      <button id="closeAdminBtn" onclick="document.getElementById('adminPanel').style.display='none'">Cerrar</button>
      <h2>Panel de Administrador</h2>
      
      <div class="admin-section">
        <h3>Subida de Imágenes</h3>
        <input type="file" id="imageUpload" accept="image/*">
        <img id="imagePreview" alt="Vista previa de imagen" style="max-width: 100%; margin-top: 10px;">
      </div>
      
      <div class="admin-section">
        <h3>Visualización de PDF</h3>
        <input type="file" id="pdfUpload" accept="application/pdf">
        <div id="pdfContainer" style="margin-top:10px;"></div>
      </div>
      
      <div class="admin-section">
        <h3>Visualización de EPUB</h3>
        <input type="file" id="epubUpload" accept=".epub">
        <div id="epubContainer" style="margin-top:10px; border:1px solid #ccc;"></div>
      </div>
      
      <div class="admin-section">
        <h3>Crear Nueva Pestaña</h3>
        <input type="text" id="newTabTitle" placeholder="Título de la pestaña">
        <textarea id="newTabContent" placeholder="Contenido de la pestaña"></textarea>
        <button id="createTabBtn">Crear Pestaña</button>
      </div>
    </div>
  </div>
</body>
</html>
